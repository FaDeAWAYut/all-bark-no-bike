[gd_scene load_steps=6 format=3 uid="uid://jj47xnxyb08a"]

[ext_resource type="PackedScene" uid="uid://yh12dv5s23ef" path="res://scenes/motorbike/interruption/smoke/smoke.tscn" id="2_40ari"]
[ext_resource type="PackedScene" uid="uid://co7c2okay1p8l" path="res://scenes/motorbike/interruption/throw/rock/rock.tscn" id="3_86fm3"]
[ext_resource type="PackedScene" uid="uid://cslgo50esooie" path="res://scenes/motorbike/interruption/throw/cigarette/cigarette.tscn" id="3_sfwgl"]
[ext_resource type="PackedScene" uid="uid://c22gh5obgnvfy" path="res://scenes/motorbike/interruption/throw/ball/ball.tscn" id="5_ej5xu"]

[sub_resource type="GDScript" id="GDScript_jvibq"]
script/source = "extends CharacterBody2D

@export var smoke_scene: PackedScene 
@onready var smoke_timer = $SmokeTimer

@export var level = 1 
@export var cigarette_scene: PackedScene
@export var rock_scene: PackedScene
@export var bouncy_ball_scene: PackedScene
@onready var throw_timer = $ThrowTimer

var projectile_scenes = [] 

func _ready():
	smoke_timer.timeout.connect(_on_smoke_timer_timeout)
	throw_timer.timeout.connect(_on_throw_timer_timeout)
	
	smoke_timer.start()
	throw_timer.start()

	projectile_scenes = [cigarette_scene, rock_scene, bouncy_ball_scene]

func _physics_process(delta):
	velocity.x = 150 
	move_and_slide()

func _on_smoke_timer_timeout():
	if !smoke_scene:
		return

	var smoke = smoke_scene.instantiate()
	
	get_parent().add_child(smoke)
	
	smoke.global_position = global_position - Vector2(100, 0) 
	
	smoke_timer.wait_time = randf_range(2.0, 5.0)
	smoke_timer.start()

func _on_throw_timer_timeout():

	if level < 2:
		return
		
	var chosen_projectile_scene = projectile_scenes.pick_random()
	
	if !chosen_projectile_scene:
		return
		
	var projectile = chosen_projectile_scene.instantiate()
	get_parent().add_child(projectile)
	
	projectile.global_position = global_position
	
	projectile.launch(Vector2(-500, -200))

	throw_timer.wait_time = randf_range(1.0, 3.0)
	throw_timer.start()
"

[node name="InterruptionMain" type="Node2D"]
script = SubResource("GDScript_jvibq")
smoke_scene = ExtResource("2_40ari")
cigarette_scene = ExtResource("3_sfwgl")
rock_scene = ExtResource("3_86fm3")
bouncy_ball_scene = ExtResource("5_ej5xu")
